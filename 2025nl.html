<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parliament Simulator - 150 Seats</title><meta property="og:title" content="Parliament Simulator">
	<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c0/Dutch_House_of_Representatives%2C_December_2023%2C_English_Wiki_colours.svg/1920px-Dutch_House_of_Representatives%2C_December_2023%2C_English_Wiki_colours.svg.png">
    <meta property="og:type" content="website"><meta property="og:url" content="https://flolhub.github.io/2025nl">
    <style>
    body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }
    h1 {
        text-align: center;
        color: #333;
    }
    .parliament {
        display: flex;
        flex-wrap: wrap;
        gap: 2px;
        margin: 30px 0;
        border: 1px solid #ddd;
        padding: 5px;
        min-height: 100px;
    }
    .seat {
        width: 20px;
        height: 20px;
        background-color: #eee;
        display: inline-block;
        cursor: pointer;
    }
    .party-info {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 20px;
    }
    .party-card {
        border: 1px solid #ddd;
        padding: 10px;
        border-radius: 5px;
        min-width: 150px;
        cursor: pointer;
    }
    .party-card.selected {
        background-color: #e6f7ff;
        border-color: #1890ff;
    }
    .party-color {
        width: 20px;
        height: 20px;
        display: inline-block;
        margin-right: 10px;
        vertical-align: middle;
    }
    button {
        background-color: #4CAF50;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        display: block;
        margin: 20px auto;
    }
    button:hover {
        background-color: #45a049;
    }
    .summary {
        margin-top: 20px;
        padding: 15px;
        background-color: #f8f8f8;
        border-radius: 5px;
    }
    .majority {
        background-color: #e8f5e9;
        border-left: 5px solid #4CAF50;
    }
    .no-majority {
        background-color: #ffebee;
        border-left: 5px solid #f44336;
    }
    .controls {
        display: flex;
        gap: 10px;
        justify-content: center;
    }
    #adjustBtn {
        background-color: #2196F3;
    }
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
    }
    .modal-content {
        background-color: #fefefe;
        margin: 10% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 600px;
        border-radius: 5px;
    }
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
    .close:hover {
        color: black;
    }
    .margin-controls {
        margin: 15px 0;
    }
    .margin-control {
        margin: 10px 0;
        padding: 10px;
        background-color: #f5f5f5;
        border-radius: 4px;
    }
    input[type="number"] {
        width: 60px;
        padding: 5px;
        margin: 0 5px;
    }
    .tab-controls {
        display: flex;
        margin-bottom: 15px;
        background-color: #f1f1f1;
        padding: 5px 5px 0 5px;
        border-radius: 5px 5px 0 0;
    }
    .tab-btn {
        padding: 10px 15px;
        background-color: #f1f1f1;
        border: 1px solid #ddd;
        border-bottom: none;
        cursor: pointer;
        font-size: 14px;
        margin-right: 5px;
        transition: all 0.3s ease;
        border-radius: 5px 5px 0 0;
    }
    .tab-btn:not(.active) {
        color: #555;
        background-color: #f1f1f1;
        border-bottom: 2px solid #ddd;
    }
    .tab-btn.active {
        border-bottom: 2px solid #2196F3;
        color: #2196F3;
        background-color: white;
    }
    .tab-btn:hover:not(.active) {
        background-color: #e9e9e9;
    }
    .tab-content {
        display: none;
    }
    .form-group {
        margin-bottom: 20px;
        padding: 15px;
        background-color: #f5f5f5;
        border-radius: 4px;
    }
    .form-group label {
        display: block;
        margin: 8px 0;
    }
    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group select {
        padding: 5px;
        margin-left: 5px;
    }
    #newPartyColor {
        width: 30px;
        height: 30px;
        vertical-align: middle;
        padding: 0;
        border: 1px solid #ddd;
    }
</style>
</head>
<body>
    <h1>Parliament Simulator (150 Seats)</h1>
    <div class="controls">
        <button id="generateBtn">Generate New Parliament</button>
        <button id="adjustBtn">Adjust Party Margins</button>
    </div>
    <div class="summary" id="summary">
        Click "Generate New Parliament" to start
    </div>
    <div class="parliament" id="parliament"></div>
    <div class="party-info" id="partyInfo"></div>

    <!-- Margin Adjustment Modal -->
    <div id="marginModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Party Management</h2>
            
            <div class="tab-controls">
                <button class="tab-btn active" onclick="openTab('adjustTab')">Adjust Margins</button>
                <button class="tab-btn" onclick="openTab('manageTab')">Manage Parties</button>
            </div>
            
            <!-- Adjust Margins Tab -->
            <div id="adjustTab" class="tab-content" style="display: block;">
                <div id="marginControls" class="margin-controls"></div>
                <button id="saveMarginsBtn">Save Margins</button>
            </div>
            
            <!-- Manage Parties Tab -->
            <div id="manageTab" class="tab-content">
                <div class="form-group">
                    <h3>Add New Party</h3>
                    <label>Party Name: <input type="text" id="newPartyName" placeholder="e.g. PartijvdSport"></label>
                    <label>Color: <input type="color" id="newPartyColor" value="#000000"></label>
                    <label>Min Seats: <input type="number" id="newPartyMin" min="0" max="149" value="5"></label>
                    <label>Default Seats: <input type="number" id="newPartyDefault" min="0" max="150" value="10"></label>
                    <label>Max Seats: <input type="number" id="newPartyMax" min="1" max="150" value="20"></label>
                    <button id="addPartyBtn">Add Party</button>
                </div>
                
                <div class="form-group">
                    <h3>Remove Party</h3>
                    <select id="partyToRemove">
                        <!-- Parties will be populated here -->
                    </select>
                    <button id="removePartyBtn">Remove Party</button>
                </div>
            </div>
        </div>
        <script>
    // Party configuration
    let parties = [
        {
                "name": "SP",
                "color": "#F60000",
                "minSeats": 3,
                "defaultSeats": 6,
                "maxSeats": 11
            },
            {
                "name": "GL/PvdA",
                "color": "#DF111A",
                "minSeats": 16,
                "defaultSeats": 28,
                "maxSeats": 30
            },
            {
                "name": "PvdD",
                "color": "#006B2D",
                "minSeats": 3,
                "defaultSeats": 6,
                "maxSeats": 12
            },
            {
                "name": "NSC",
                "color": "#F0C400",
                "minSeats": 1,
                "defaultSeats": 2,
                "maxSeats": 31
            },
            {
                "name": "CU",
                "color": "#00A7EB",
                "minSeats": 2,
                "defaultSeats": 3,
                "maxSeats": 8
            },
            {
                "name": "Volt",
                "color": "#582C83",
                "minSeats": 1,
                "defaultSeats": 3,
                "maxSeats": 10
            },
            {
                "name": "D66",
                "color": "#00AE41",
                "minSeats": 5,
                "defaultSeats": 12,
                "maxSeats": 26
            },
            {
                "name": "DENK",
                "color": "#00B7B2",
                "minSeats": 2,
                "defaultSeats": 4,
                "maxSeats": 5
            },
            {
                "name": "CDA",
                "color": "#2CC84D",
                "minSeats": 4,
                "defaultSeats": 17,
                "maxSeats": 19
            },
            {
                "name": "VVD",
                "color": "#0A2CCA",
                "minSeats": 12,
                "defaultSeats": 26,
                "maxSeats": 39
            },
            {
                "name": "BBB",
                "color": "#94C11F",
                "minSeats": 2,
                "defaultSeats": 4,
                "maxSeats": 36
            },
            {
                "name": "SGP",
                "color": "#EA5B0B",
                "minSeats": 2,
                "defaultSeats": 3,
                "maxSeats": 4
            },
            {
                "name": "PVV",
                "color": "#012758",
                "minSeats": 9,
                "defaultSeats": 29,
                "maxSeats": 52
            },
            {
                "name": "FvD",
                "color": "#841818",
                "minSeats": 3,
                "defaultSeats": 5,
                "maxSeats": 9
            },
            {
                "name": "JA21",
                "color": "#242B57",
                "minSeats": 1,
                "defaultSeats": 4,
                "maxSeats": 15
            }
    ];

    let currentSeatCounts = [];
    let selectedParties = new Set();

    // DOM elements
    const generateBtn = document.getElementById('generateBtn');
    const adjustBtn = document.getElementById('adjustBtn');
    const modal = document.getElementById('marginModal');
    const closeBtn = document.querySelector('.close');
    const saveMarginsBtn = document.getElementById('saveMarginsBtn');
    const marginControls = document.getElementById('marginControls');
    const addPartyBtn = document.getElementById('addPartyBtn');
    const removePartyBtn = document.getElementById('removePartyBtn');
    const partyToRemove = document.getElementById('partyToRemove');

    // Event listeners
    generateBtn.addEventListener('click', generateParliament);
    adjustBtn.addEventListener('click', showMarginModal);
    closeBtn.addEventListener('click', closeModal);
    saveMarginsBtn.addEventListener('click', saveMargins);
    addPartyBtn.addEventListener('click', addNewParty);
    removePartyBtn.addEventListener('click', removeSelectedParty);
    window.addEventListener('click', (event) => {
        if (event.target === modal) {
            closeModal();
        }
    });

    function generateParliament() {
        // Reset selections
        selectedParties = new Set();
        
        // First pass - generate initial seat counts weighted toward defaults
        currentSeatCounts = [];
        let totalSeats = 0;
        
        // Generate initial seat counts within min/max, weighted toward default
        parties.forEach(party => {
            // Create a distribution that favors values near the default
            const range = party.maxSeats - party.minSeats;
            let seats;
            
            // Try to get values near the default (normal distribution)
            do {
                // Standard deviation is 1/4 of the range to keep it somewhat centered
                const stdDev = range / 4;
                seats = Math.round(randomNormal(party.defaultSeats, stdDev));
                seats = Math.max(party.minSeats, Math.min(party.maxSeats, seats));
            } while (isNaN(seats));
            
            currentSeatCounts.push({
                party: party,
                seats: seats
            });
            totalSeats += seats;
        });

        // Adjust to exactly 150 seats
        while (totalSeats !== 150) {
            const difference = 150 - totalSeats;
            const adjustment = Math.sign(difference);

            // Find parties that can be adjusted without violating their constraints
            const adjustableParties = currentSeatCounts.filter(sc => {
                if (adjustment > 0) return sc.seats < sc.party.maxSeats;
                else return sc.seats > sc.party.minSeats;
            });

            if (adjustableParties.length === 0) break;

            // Distribute the adjustment randomly among adjustable parties
            const randomParty = adjustableParties[Math.floor(Math.random() * adjustableParties.length)];
            randomParty.seats += adjustment;
            totalSeats += adjustment;
        }

        // Sort by seat count (descending)
        currentSeatCounts.sort((a, b) => b.seats - a.seats);

        // Render parliament visualization
        renderParliament();

        // Update summary
        updateSummary();
    }

    function renderParliament() {
        const parliamentEl = document.getElementById('parliament');
        const partyInfoEl = document.getElementById('partyInfo');
        
        parliamentEl.innerHTML = '';
        partyInfoEl.innerHTML = '';

        currentSeatCounts.forEach(sc => {
            for (let i = 0; i < sc.seats; i++) {
                const seat = document.createElement('div');
                seat.className = 'seat';
                seat.style.backgroundColor = sc.party.color;
                seat.title = `${sc.party.name} (${sc.seats} seats)`;
                seat.dataset.party = sc.party.name;
                seat.addEventListener('click', () => togglePartySelection(sc.party.name));
                parliamentEl.appendChild(seat);
            }
        });

        currentSeatCounts.forEach(sc => {
            const card = document.createElement('div');
            card.className = `party-card ${selectedParties.has(sc.party.name) ? 'selected' : ''}`;
            card.innerHTML = `
                <div><span class="party-color" style="background-color: ${sc.party.color}"></span> <strong>${sc.party.name}</strong></div>
                <div>Seats: ${sc.seats}</div>
            `;
            card.addEventListener('click', () => togglePartySelection(sc.party.name));
            partyInfoEl.appendChild(card);
        });
    }

    function togglePartySelection(partyName) {
        if (selectedParties.has(partyName)) {
            selectedParties.delete(partyName);
        } else {
            selectedParties.add(partyName);
        }
        renderParliament();
        updateSummary();
    }

    function updateSummary() {
        const majorityThreshold = Math.floor(150 / 2) + 1;
        let totalSelectedSeats = 0;
        let selectedPartyList = [];

        currentSeatCounts.forEach(sc => {
            if (selectedParties.has(sc.party.name)) {
                totalSelectedSeats += sc.seats;
                selectedPartyList.push(sc.party.name);
            }
        });

        const summary = document.getElementById('summary');
        
        if (selectedParties.size === 0) {
            summary.className = "summary";
            summary.innerHTML = `
                Parliament generated. Select parties to see if they form a majority.
                <br><strong>Total seats allocated:</strong> ${currentSeatCounts.reduce((sum, sc) => sum + sc.seats, 0)}/150
            `;
        } else {
            if (totalSelectedSeats >= majorityThreshold) {
                summary.className = "summary majority";
                summary.innerHTML = `
                    <strong>MAJORITY COALITION (${totalSelectedSeats} seats)</strong><br>
                    Selected parties: ${selectedPartyList.join(", ")}<br>
                    These parties have enough seats to form a majority government.
                    <br><strong>Total selected seats:</strong> ${totalSelectedSeats}/150 (need ${majorityThreshold}+)
                `;
            } else {
                summary.className = "summary no-majority";
                summary.innerHTML = `
                    <strong>NO MAJORITY (${totalSelectedSeats} seats)</strong><br>
                    Selected parties: ${selectedPartyList.join(", ")}<br>
                    These parties do not have enough seats to form a majority.
                    <br><strong>Total selected seats:</strong> ${totalSelectedSeats}/150 (need ${majorityThreshold}+)
                `;
            }
        }
    }

    function showMarginModal() {
        marginControls.innerHTML = '';
        
        parties.forEach((party, index) => {
            const control = document.createElement('div');
            control.className = 'margin-control';
            control.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">
                    <span style="display: inline-block; width: 20px; height: 20px; background-color: ${party.color}; margin-right: 10px;"></span>
                    ${party.name}
                </div>
                <div>
                    Min: <input type="number" id="min-${index}" value="${party.minSeats}" min="0" max="149">
                    Default: <input type="number" id="default-${index}" value="${party.defaultSeats}" min="0" max="150">
                    Max: <input type="number" id="max-${index}" value="${party.maxSeats}" min="1" max="150">
                </div>
            `;
            marginControls.appendChild(control);
        });
        
        // Populate the remove party dropdown
        partyToRemove.innerHTML = '';
        parties.forEach(party => {
            const option = document.createElement('option');
            option.value = party.name;
            option.textContent = party.name;
            partyToRemove.appendChild(option);
        });
        
        modal.style.display = 'block';
    }

    function closeModal() {
        modal.style.display = 'none';
    }

    function saveMargins() {
        parties.forEach((party, index) => {
            party.minSeats = parseInt(document.getElementById(`min-${index}`).value);
            party.defaultSeats = parseInt(document.getElementById(`default-${index}`).value);
            party.maxSeats = parseInt(document.getElementById(`max-${index}`).value);
            
            // Ensure min <= default <= max
            if (party.minSeats > party.defaultSeats) party.minSeats = party.defaultSeats;
            if (party.defaultSeats > party.maxSeats) party.defaultSeats = party.maxSeats;
            if (party.minSeats > party.maxSeats) party.minSeats = party.maxSeats;
        });
        
        closeModal();
    }

    function openTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.style.display = 'none';
        });
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        document.getElementById(tabId).style.display = 'block';
        event.currentTarget.classList.add('active');
    }

    function addNewParty() {
        const name = document.getElementById('newPartyName').value.trim();
        const color = document.getElementById('newPartyColor').value;
        const min = parseInt(document.getElementById('newPartyMin').value);
        const def = parseInt(document.getElementById('newPartyDefault').value);
        const max = parseInt(document.getElementById('newPartyMax').value);
        
        if (!name) {
            alert('Please enter a party name');
            return;
        }
        
        if (min > def || def > max) {
            alert('Please ensure min ≤ default ≤ max');
            return;
        }
        
        // Check if party already exists
        if (parties.some(p => p.name === name)) {
            alert('A party with this name already exists');
            return;
        }
        
        parties.push({
            name: name,
            color: color,
            minSeats: min,
            defaultSeats: def,
            maxSeats: max
        });
        
        // Clear the form
        document.getElementById('newPartyName').value = '';
        document.getElementById('newPartyMin').value = '5';
        document.getElementById('newPartyDefault').value = '10';
        document.getElementById('newPartyMax').value = '20';
        
        // Update the remove dropdown and regenerate parliament
        generateParliament();
        alert(`${name} party added successfully!`);
    }

    function removeSelectedParty() {
        const partyName = partyToRemove.value;
        
        if (!partyName) {
            alert('Please select a party to remove');
            return;
        }
        
        if (parties.length <= 2) {
            alert('You must have at least 2 parties');
            return;
        }
        
        if (confirm(`Are you sure you want to remove the ${partyName} party?`)) {
            parties = parties.filter(p => p.name !== partyName);
            
            // Remove from selected parties if it was selected
            selectedParties.delete(partyName);
            
            // Regenerate parliament
            generateParliament();
            
            // Update the modal
            showMarginModal();
        }
    }

    function randomNormal(mean, stdDev) {
        let u = 0, v = 0;
        while (u === 0) u = Math.random();
        while (v === 0) v = Math.random();
        const normal = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
        return mean + stdDev * normal;
    }

    // Initialize the parliament on load
    generateParliament();
</script>
    </div>
